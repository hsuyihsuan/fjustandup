<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="{{ url_for('static', path='/assets/css/custom.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', path='/assets/javascript/echarts.js') }}"></script>
</head>

<body>
    <div id="blood_pressure" class="basic mt-3" style="height: 90vh"></div>


    <script>
        var dom = document.getElementById('blood_pressure');
        var blood_pressure_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var app = {};

        var option;

        let blood_pressure_dates = {{ all_visit_date_asc| safe}};
        let sbp_data = {{ sbp| safe}};
        let dbp_data = {{ dbp| safe}};

        option = {
            tooltip: {
                trigger: 'axis',
                position: function (pt) {
                    return [pt[0], '10%'];
                }
            },
            title: {
                left: 'center',
                text: '收縮壓、舒張壓折線圖'
            },
            toolbox: {
                feature: {

                    dataView: {
                        optionToContent: function (opt) {
                            var axisData = opt.xAxis[0].data;
                            var series = opt.series;
                            var tdHeads = '<th>日期</th>';
                            series.forEach(function (item) {
                                tdHeads += '<th>' + item.name + '</th>';
                            });
                            var table = '<table class="table table-hover">' + '<thead>' + tdHeads + '</thead><tbody>';
                            var tdBodys = '';
                            for (var i = 0, l = axisData.length; i < l; i++) {
                                for (var j = 0; j < series.length; j++) {
                                    if (typeof (series[j].data[i]) == 'object') {
                                        tdBodys += '<td>' + series[j].data[i].value + '</td>';
                                    } else {
                                        tdBodys += '<td>' + series[j].data[i] + '</td>';
                                    }
                                }
                                table += '<tr><td>' + axisData[i] + '</td>' + tdBodys + '</tr>';
                                tdBodys = '';
                            }
                            table += '</tbody></table>';
                            return table;
                        }
                    },
                    restore: {},
                    saveAsImage: {}
                }
            },
            legend: {
                left: 10,
                data: ['收縮壓', '舒張壓']

            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: blood_pressure_dates
            },
            yAxis: {
                type: 'value',
                boundaryGap: [0, '100%']
            },
            dataZoom: [
                {
                    type: 'inside',
                    start: 40,
                    end: 100
                },
                {
                    start: 40,
                    end: 100
                }
            ],
            series: [
                {
                    name: '收縮壓',
                    type: 'line',
                    sampling: 'lttb',
                    itemStyle: {
                        color: 'red'
                    },
                    label: {
                        show: true,
                        position: 'bottom',
                        textStyle: { fontSize: 15 }

                    },

                    data: sbp_data
                },
                {
                    name: '舒張壓',
                    type: 'line',
                    sampling: 'lttb',

                    label: {
                        show: true,
                        position: 'bottom',
                        textStyle: { fontSize: 15 }
                    },
                    data: dbp_data
                }
            ]
        };

        if (option && typeof option === 'object') {
            blood_pressure_chart.setOption(option);
        }

        window.addEventListener('resize', blood_pressure_chart.resize);
    </script>

</body>

</html>